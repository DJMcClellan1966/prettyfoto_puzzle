const puzzles=[{id:1,title:"Cherry on Top",category:"butterflies",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719947771/IMG_1842_z7mzjy.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-1842?product_gallery=303973&product_id=7351866",galleryUrl:"https://www.prettyfoto.com/butterflies-in-nature",story:{location:"Butterfly Garden, NC",season:"Summer",moment:"This Gulf Fritillary paused just long enough on the cherry-red bloom to capture its iridescent wings catching the afternoon light.",tags:["butterfly","nature","wildlife","macro","orange butterfly","garden"]}},{id:2,title:"Nature's Jewel",category:"butterflies",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1694475326/Jennifer_McClellan_008Cfc2f-1102-42Ba-Afef-D728dcafa2b5_o6h4nh.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/jennifer-mcclellan-008cfc2f-1102-42ba-afef-d728dcafa2b5?product_gallery=303973&product_id=6389616",galleryUrl:"https://www.prettyfoto.com/butterflies-in-nature",story:{location:"Mountain Meadow",season:"Late Summer",moment:"Like a living gemstone, this butterfly's wings shimmer with colors that remind us nature is the greatest artist.",tags:["butterfly","nature","jewel tones","wildlife","meadow","colorful"]}},{id:3,title:"Love Blooms",category:"flowers",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159071/2N4A4426_o4lj30.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4426?product_gallery=302625&product_id=7841076",galleryUrl:"https://www.prettyfoto.com/tulips"},{id:4,title:"My One and Only",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159079/IMG_0594_yndoza.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-0594?product_gallery=302625&product_id=7841105",galleryUrl:"https://www.prettyfoto.com/tulips"},{id:5,title:"Love's Flame",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159079/IMG_0631_nuav1f.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-0631?product_gallery=302625&product_id=7841103",galleryUrl:"https://www.prettyfoto.com/tulips"},{id:6,title:"On the Move",category:"flowers",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1693521613/Jennifer_McClellan_Img_0261_giehor.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/jennifer-mcclellan-img-0261?product_gallery=302623&product_id=6350814",galleryUrl:"https://www.prettyfoto.com/orchids"},{id:7,title:"Pretty on Point",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113391/2N4A5107_imfztx.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a5107?product_gallery=302623&product_id=7331073",galleryUrl:"https://www.prettyfoto.com/orchids"},{id:8,title:"Water Lily Afternoon",category:"flowers",featuredWeek:4,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1714324985/IMG_1453_ypftdw.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-1453?product_gallery=327276&product_id=7186902",galleryUrl:"https://www.prettyfoto.com/floating-gems-water-lilies"},{id:9,title:"Best in Show",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1700958423/IMG_8345_maatlv.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-8345?product_gallery=327276&product_id=6666746",galleryUrl:"https://www.prettyfoto.com/floating-gems-water-lilies"},{id:10,title:"Sunny Daze",category:"flowers",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113429/2N4A5194_situp5.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a5194?product_gallery=342700&product_id=7331079",galleryUrl:"https://www.prettyfoto.com/sun-kissed-sunflowers"},{id:11,title:"Center Stage",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113491/2N4A5195_d6urme.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a5195?product_gallery=342700&product_id=7331092",galleryUrl:"https://www.prettyfoto.com/sun-kissed-sunflowers"},{id:12,title:"Cherry Swirl",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159084/IMG_1512_q9xltq.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-1512?product_gallery=332734&product_id=7841125",galleryUrl:"https://www.prettyfoto.com/pretty-in-pink-cherry-blossoms"},{id:13,title:"Golden Days",category:"horses",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113644/2N4A4928_ugnovr.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4928?product_gallery=331150&product_id=7331108",galleryUrl:"https://www.prettyfoto.com/equine-beauties"},{id:14,title:"Magic Moment",category:"horses",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708488576/IMG_2866_b8y05a.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-2866?product_gallery=331150&product_id=6987885",galleryUrl:"https://www.prettyfoto.com/equine-beauties"},{id:15,title:"Counting Sheep 2",category:"landscapes",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113554/2N4A4751_ugqv2k.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4751?product_gallery=303977&product_id=7331096",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:16,title:"An Unexpected View",category:"landscapes",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113577/IMG_2394_nbgkpf.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-2394?product_gallery=303977&product_id=7331099",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:17,title:"Garden Visitor",category:"butterflies",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719947771/IMG_1842_z7mzjy.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-1842?product_gallery=303973&product_id=7351866",galleryUrl:"https://www.prettyfoto.com/butterflies-in-nature",story:{location:"Garden",season:"Summer",moment:"A delicate butterfly exploring vibrant blooms",tags:["butterfly","garden","nature","summer"]}},{id:18,title:"Wings of Wonder",category:"butterflies",featuredWeek:4,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1694475326/Jennifer_McClellan_008Cfc2f-1102-42Ba-Afef-D728dcafa2b5_o6h4nh.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/jennifer-mcclellan-008cfc2f-1102-42ba-afef-d728dcafa2b5?product_gallery=303973&product_id=6389616",galleryUrl:"https://www.prettyfoto.com/butterflies-in-nature",story:{location:"Wildflower Field",season:"Spring",moment:"Nature's artistry on display",tags:["butterfly","wildflower","spring","nature"]}},{id:19,title:"Pink Perfection",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159071/2N4A4426_o4lj30.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4426?product_gallery=302625&product_id=7841076",galleryUrl:"https://www.prettyfoto.com/tulips"},{id:20,title:"Tulip Dreams",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1737159079/IMG_0594_yndoza.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-0594?product_gallery=302625&product_id=7841105",galleryUrl:"https://www.prettyfoto.com/tulips"},{id:21,title:"Orchid Elegance",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1693521613/Jennifer_McClellan_Img_0261_giehor.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/jennifer-mcclellan-img-0261?product_gallery=302623&product_id=6350814",galleryUrl:"https://www.prettyfoto.com/orchids"},{id:22,title:"Blooming Delight",category:"flowers",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113391/2N4A5107_imfztx.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a5107?product_gallery=302623&product_id=7331073",galleryUrl:"https://www.prettyfoto.com/orchids"},{id:23,title:"Sunset Serenity",category:"horses",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113644/2N4A4928_ugnovr.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4928?product_gallery=331150&product_id=7331108",galleryUrl:"https://www.prettyfoto.com/equine-beauties"},{id:24,title:"Equine Grace",category:"horses",featuredWeek:4,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708488576/IMG_2866_b8y05a.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-2866?product_gallery=331150&product_id=6987885",galleryUrl:"https://www.prettyfoto.com/equine-beauties"},{id:25,title:"Mountain Majesty",category:"landscapes",featuredWeek:4,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113554/2N4A4751_ugqv2k.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4751?product_gallery=303977&product_id=7331096",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:26,title:"Scenic Vista",category:"landscapes",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113577/IMG_2394_nbgkpf.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-2394?product_gallery=303977&product_id=7331099",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:27,title:"Rolling Hills",category:"landscapes",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719114051/2N4A5331_t6yzzm.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a5331?product_gallery=303977&product_id=7331115",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:28,title:"Nature's Canvas",category:"landscapes",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113554/2N4A4751_ugqv2k.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4751?product_gallery=303977&product_id=7331096",galleryUrl:"https://www.prettyfoto.com/mountains"},{id:29,title:"The Group",category:"animal friends",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435150/2N4A3976_exwxyi.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3976?product_gallery=356180&product_id=7051118",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals",story:{location:"Wildlife Park",season:"Year-round",moment:"Animal friends gathered together in harmony",tags:["wildlife","animals","nature","zoo"]}},{id:30,title:"Bamboo Please",category:"animal friends",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435121/2N4A3957_ghvvp3.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3957?product_gallery=356180&product_id=7051074",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:31,title:"Follow Me",category:"animal friends",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435096/2N4A3943_aetdfe.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3943?product_gallery=356180&product_id=7051054",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:32,title:"Spring Bloom",category:"rural",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719947911/IMG_9542_fhxzpf.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/img-9542?product_gallery=327278&product_id=7351883",galleryUrl:"https://www.prettyfoto.com/blissful-spaces-farm-fields",story:{location:"Rolling Farmland",season:"Spring",moment:"Wildflowers blanket the countryside in nature's celebration",tags:["farm","countryside","wildflowers","rural"]}},{id:33,title:"Forever Fields",category:"rural",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1701051934/2037768f-721e-488f-b05f-175b45bcf26e_d10ldy.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2037768f-721e-488f-b05f-175b45bcf26e-9a66cw1rkzk?product_gallery=327278&product_id=6670029",galleryUrl:"https://www.prettyfoto.com/blissful-spaces-farm-fields"},{id:34,title:"Pastoral Peace",category:"rural",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719113554/2N4A4751_ugqv2k.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4751?product_gallery=303977&product_id=7331096",galleryUrl:"https://www.prettyfoto.com/blissful-spaces-farm-fields"},{id:35,title:"Stripes",category:"city safari",featuredWeek:2,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1719947865/2N4A4432_b5v8fu.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4432?product_gallery=356180&product_id=7351884",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals",story:{location:"Zoo Safari",season:"Year-round",moment:"A zebra's striking pattern captured in golden light",tags:["zebra","zoo","wildlife","exotic animals"]}},{id:36,title:"Hugs",category:"city safari",featuredWeek:3,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435066/2N4A3890_ldyacl.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3890?product_gallery=356180&product_id=7051039",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:37,title:"Baby Rhino",category:"city safari",featuredWeek:4,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435019/2N4A3869_geyxxu.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3869?product_gallery=356180&product_id=7051045",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:38,title:"King of the Jungle",category:"city safari",featuredWeek:1,image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435145/2N4A3983_xaxwpc.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3983?product_gallery=356180&product_id=7051109",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:39,title:"Burning Bright",category:"city safari",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435346/2N4A4011_aw6vdq.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a4011?product_gallery=356180&product_id=7051143",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"},{id:40,title:"The Elephant in the Room",category:"city safari",image:"https://images.discerningassets.com/image/upload/c_fill,w_600,h_600,q_auto:best/v1708435033/2N4A3874_svvqoj.jpg",shopUrl:"https://www.prettyfoto.com/warehouse-open-edition-prints/art_print_products/2n4a3874?product_gallery=356180&product_id=7051057",galleryUrl:"https://www.prettyfoto.com/city-safari-wild-and-exotic-animals"}],STORAGE_KEY="prettyfoto_puzzle",EPOCH=new Date("2026-02-03").getTime(),DAY_MS=864e5,WEEK_MS=7*DAY_MS;let currentPuzzle=null,isDaily=!1,gridSize=4,tiles=[],emptyIndex=0,moves=0,seconds=0,timerInterval=null,gameStarted=!1,tileImages=[],cachedTileSize=0,shuffleSeed=0,soundEnabled=!0,deferredPrompt=null,stats={played:0,won:0,currentStreak:0,bestStreak:0,totalMoves:0,totalTime:0,lastPlayedDate:null,todayCompleted:!1,todayMoves:0,todayTime:0,hasSeenOnboarding:!1,hasSeenPromo:!1,dailyFirstCount:0,galleryFirstCount:0,dailySkippedCount:0,galleryPlays:0,dailyPlays:0,shopClicks:0},sessionState={dailyStarted:!1,galleryStarted:!1,firstAction:null,sessionRecorded:!1},userPrefs={categoryPlays:{butterflies:0,flowers:0,horses:0,landscapes:0,"animal friends":0,rural:0,"city safari":0},gamePlays:{slider:0},natureSoul:null,favoriteImages:[],visitCount:0,lastVisit:null,preferredGame:"slider"};const PREFS_KEY="prettyfoto_prefs";function loadPrefs(){const e=localStorage.getItem(PREFS_KEY);if(e){const t=JSON.parse(e);userPrefs={...userPrefs,...t},userPrefs.categoryPlays=userPrefs.categoryPlays||{butterflies:0,flowers:0,horses:0,landscapes:0,"animal friends":0,rural:0,"city safari":0},userPrefs.categoryPlays["animal friends"]||(userPrefs.categoryPlays["animal friends"]=0),userPrefs.categoryPlays.rural||(userPrefs.categoryPlays.rural=0),userPrefs.categoryPlays["city safari"]||(userPrefs.categoryPlays["city safari"]=0),userPrefs.gamePlays=userPrefs.gamePlays||{slider:0},userPrefs.favoriteImages=userPrefs.favoriteImages||[]}userPrefs.visitCount++,userPrefs.lastVisit=(new Date).toISOString(),savePrefs()}function savePrefs(){localStorage.setItem(PREFS_KEY,JSON.stringify(userPrefs))}function trackCategoryPlay(e){void 0!==userPrefs.categoryPlays[e]&&(userPrefs.categoryPlays[e]++,savePrefs())}function trackGamePlay(e){void 0!==userPrefs.gamePlays[e]&&(userPrefs.gamePlays[e]++,updatePreferredGame(),savePrefs())}function updatePreferredGame(){userPrefs.preferredGame="slider"}function getFavoriteCategory(){let e=0,t=null;for(const[a,o]of Object.entries(userPrefs.categoryPlays))o>e&&(e=o,t=a);return e>0?t:null}function getWelcomeMessage(){const e=userPrefs.natureSoul,t=userPrefs.visitCount,a=getFavoriteCategory(),o={dreamer:"Dreamer",explorer:"Explorer",nurturer:"Nurturer",freeSpirit:"Free Spirit"};if(1===t)return{title:"Welcome!",subtitle:"Discover beautiful nature photography"};if(e&&o[e])return{title:`Welcome back, ${o[e]}! ${{dreamer:"ü¶ã",explorer:"üèîÔ∏è",nurturer:"üå∏",freeSpirit:"üê¥"}[e]}`,subtitle:`Ready for today's ${a||"nature"} adventure?`};if(t>5){if(a)return{title:`Welcome back! ${{butterflies:"ü¶ã",flowers:"üå∏",horses:"üê¥",landscapes:"üèîÔ∏è"}[a]||"üåü"}`,subtitle:`We have new ${a} for you!`}}return{title:"Welcome back!",subtitle:"New puzzles await you"}}function getThemeColors(){const e=userPrefs.natureSoul,t=getFavoriteCategory(),a={dreamer:{primary:"#9b59b6",light:"#e8daef"},explorer:{primary:"#3498db",light:"#d6eaf8"},nurturer:{primary:"#e91e63",light:"#fce4ec"},freeSpirit:{primary:"#e67e22",light:"#fdebd0"}},o={butterflies:"dreamer",landscapes:"explorer",flowers:"nurturer",horses:"freeSpirit"};return e&&a[e]?a[e]:t&&o[t]?a[o[t]]:null}function applyPersonalizedTheme(){const e=getThemeColors();e&&(document.documentElement.style.setProperty("--accent",e.primary),document.documentElement.style.setProperty("--accent-light",e.light))}function toggleFavorite(e){const t=userPrefs.favoriteImages.indexOf(e);return t>-1?userPrefs.favoriteImages.splice(t,1):userPrefs.favoriteImages.push(e),savePrefs(),userPrefs.favoriteImages.includes(e)}function isFavorite(e){return userPrefs.favoriteImages.includes(e)}function markPuzzleCompleted(e){userPrefs.completedPuzzles||(userPrefs.completedPuzzles=[]),userPrefs.completedPuzzles.includes(e)||(userPrefs.completedPuzzles.push(e),savePrefs())}const DEFAULT_STORIES={butterflies:{locations:["Butterfly Garden, NC","Mountain Meadow","Wildflower Field","Nature Reserve"],seasons:["Spring","Summer","Late Summer","Early Fall"],moments:["A fleeting moment of stillness captured as delicate wings catch the golden light.","Nature's living artwork - each wing pattern tells a story millions of years in the making.","Time seemed to stop as this beautiful creature paused in its endless dance among the flowers."]},flowers:{locations:["Botanical Garden","Private Garden","Meadow Trail","Countryside"],seasons:["Spring","Early Summer","Peak Bloom","Golden Hour"],moments:["Petals unfurling in the morning dew, a daily miracle we often overlook.","Each bloom is a celebration - nature's way of showing us that beauty needs no purpose.","In the quiet of the garden, this flower seemed to glow from within."]},horses:{locations:["Open Range, Montana","Countryside Pasture","Mountain Valley","Golden Fields"],seasons:["Autumn","Summer Evening","Spring Morning","Winter Light"],moments:["Wild and free - this majestic creature embodies the spirit we all long for.","A moment of connection between photographer and subject, trust earned through patience.","The golden light transformed an ordinary moment into something magical."]},landscapes:{locations:["Blue Ridge Mountains","Pacific Northwest","Rocky Mountains","Coastal Cliffs"],seasons:["Golden Hour","Blue Hour","Misty Morning","After the Storm"],moments:["Standing here, the world felt infinite and all worries seemed impossibly small.","Nature's grandeur reminds us we're part of something much larger than ourselves.","I waited hours for this light - some moments are worth any amount of patience."]}};function getStoryForPuzzle(e){if(e.story)return e.story;const t=DEFAULT_STORIES[e.category]||DEFAULT_STORIES.flowers,a=e.id;return{location:t.locations[a%t.locations.length],season:t.seasons[a%t.seasons.length],moment:t.moments[a%t.moments.length],tags:getCategoryTags(e.category,e.title)}}function getCategoryTags(e,t){const a={butterflies:["butterfly","nature","wildlife","macro","wings","garden"],flowers:["flower","botanical","bloom","garden","nature","floral"],horses:["horse","equine","wildlife","freedom","nature","majestic"],landscapes:["landscape","scenic","nature","mountains","travel","adventure"]},o=[...a[e]||a.flowers];return t.toLowerCase().split(" ").forEach(e=>{e.length>3&&!o.includes(e)&&o.push(e)}),o.slice(0,8)}function showStoryModal(e){if(!e)return;playSound("click");const t=getStoryForPuzzle(e);setImageSrcWithFallback(document.getElementById("storyImage"),getThumbnailUrl(e.image,400)),document.getElementById("storyTitle").textContent=e.title,document.getElementById("storyLocation").textContent=t.location,document.getElementById("storySeason").textContent=t.season,document.getElementById("storyMoment").textContent=`"${t.moment}"`,document.getElementById("storyShopLink").href=e.shopUrl,document.getElementById("storyTags").innerHTML=t.tags.map(e=>`<span class="story-tag">${e}</span>`).join(""),document.getElementById("storyPlayBtn").onclick=()=>{const t=document.getElementById("storyModal");t.classList.add("hidden"),setModalAria(t,!1),selectPuzzle(e.id)};const a=document.getElementById("storyModal");a.classList.remove("hidden"),setModalAria(a,!0)}function setupStoryModal(){document.getElementById("closeStoryModal").onclick=()=>{const e=document.getElementById("storyModal");e.classList.add("hidden"),setModalAria(e,!1)},document.getElementById("storyModal").onclick=e=>{if("storyModal"===e.target.id){const e=document.getElementById("storyModal");e.classList.add("hidden"),setModalAria(e,!1)}},document.getElementById("viewStoryBtn").onclick=()=>{showStoryModal(currentPuzzle)}}let audioCtx=null;function initAudio(){return audioCtx||(audioCtx=new(window.AudioContext||window.webkitAudioContext)),audioCtx}function playSound(e){if(soundEnabled)try{const t=initAudio(),a=t.createOscillator(),o=t.createGain();switch(a.connect(o),o.connect(t.destination),e){case"slide":a.frequency.setValueAtTime(400,t.currentTime),a.frequency.exponentialRampToValueAtTime(300,t.currentTime+.1),o.gain.setValueAtTime(.1,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),a.start(t.currentTime),a.stop(t.currentTime+.1);break;case"win":[523.25,659.25,783.99,1046.5].forEach((e,a)=>{const o=t.createOscillator(),r=t.createGain();o.connect(r),r.connect(t.destination),o.frequency.setValueAtTime(e,t.currentTime+.15*a),r.gain.setValueAtTime(.15,t.currentTime+.15*a),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.15*a+.3),o.start(t.currentTime+.15*a),o.stop(t.currentTime+.15*a+.3)});break;case"click":a.frequency.setValueAtTime(600,t.currentTime),o.gain.setValueAtTime(.05,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+.05),a.start(t.currentTime),a.stop(t.currentTime+.05)}}catch(e){}}function vibrate(e){navigator.vibrate&&navigator.vibrate(e)}const homeView=document.getElementById("homeView"),puzzleView=document.getElementById("puzzleView"),puzzleGallery=document.getElementById("puzzleGallery"),puzzleTitle=document.getElementById("puzzleTitle"),puzzlePreview=document.getElementById("puzzlePreview"),difficultySelect=document.getElementById("difficultySelect"),gameArea=document.getElementById("gameArea"),puzzleBoard=document.getElementById("puzzleBoard"),timerDisplay=document.getElementById("timer"),movesDisplay=document.getElementById("moves"),shopLink=document.getElementById("shopLink"),completionModal=document.getElementById("completionModal"),hintModal=document.getElementById("hintModal"),statsModal=document.getElementById("statsModal"),onboardingModal=document.getElementById("onboardingModal"),emailModal=document.getElementById("emailModal");function setModalAria(e,t){e&&e.setAttribute("aria-hidden",t?"false":"true")}function setViewAria(e,t){e&&e.setAttribute("aria-hidden",t?"true":"false")}const confettiCanvas=document.getElementById("confetti");function applyPersonalization(){applyPersonalizedTheme();const e=getWelcomeMessage();document.getElementById("welcomeTitle").textContent=e.title,document.getElementById("welcomeSubtitle").textContent=e.subtitle}document.addEventListener("DOMContentLoaded",()=>{loadStats(),loadPrefs(),setViewAria(homeView,!1),setViewAria(puzzleView,!0),registerServiceWorker(),applyPersonalization(),setupDailyPuzzle(),renderGallery(),setupEventListeners(),startCountdown(),checkOnboarding(),setupPWAInstall(),updateSoundButton(),setupStoryModal()});const PWA_CACHE_NAME="prettyfoto-puzzle-v2";function registerServiceWorker(){"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(()=>{navigator.serviceWorker.controller?precachePuzzleImages():navigator.serviceWorker.ready.then(precachePuzzleImages)}).catch(()=>{})}function precachePuzzleImages(){if(!("caches"in window))return;const e=[...new Set(puzzles.map(e=>e.image))];let t=0;function a(){if(t>=e.length)return;const o=e[t++];fetch(o,{mode:"cors"}).then(e=>e.ok?e:Promise.reject()).then(e=>{const t=e.clone();return caches.open(PWA_CACHE_NAME).then(e=>e.put(o,t)).then(()=>e)}).then(()=>a(),()=>a())}for(let e=0;e<3;e++)a()}function loadImageWithCacheFallback(e,t,a,o){t.onload=a,t.onerror=()=>{"caches"in window?caches.match(e).then(e=>{e?e.blob().then(e=>{t.src=URL.createObjectURL(e),t.onerror=o}):o&&o()}):o&&o()},t.crossOrigin="anonymous",t.src=e}function setImageSrcWithFallback(e,t){e&&t&&(e.onerror=function(){e.onerror=null,"caches"in window&&caches.match(t).then(t=>{t&&t.blob().then(t=>{e.src=URL.createObjectURL(t)})})},e.src=t)}function setupPWAInstall(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,document.getElementById("installBtn").classList.remove("hidden")}),document.getElementById("installBtn").addEventListener("click",async()=>{deferredPrompt&&(deferredPrompt.prompt(),await deferredPrompt.userChoice,deferredPrompt=null,document.getElementById("installBtn").classList.add("hidden"))})}function checkOnboarding(){stats.hasSeenOnboarding||(onboardingModal.classList.remove("hidden"),setModalAria(onboardingModal,!0))}function setupEventListeners(){document.getElementById("soundBtn").addEventListener("click",toggleSound),document.getElementById("statsBtn").addEventListener("click",showStats),document.getElementById("closeStats").addEventListener("click",()=>{statsModal.classList.add("hidden"),setModalAria(statsModal,!1)}),document.getElementById("playDailyBtn").addEventListener("click",playDaily),document.getElementById("shareAppBtn").addEventListener("click",()=>shareApp()),document.getElementById("shareResultBtn").addEventListener("click",()=>{shareApp({text:isDaily?"I just completed today's PrettyFoto puzzle! üß© New puzzle every day ‚Äî try it:":"Just finished a nature photo puzzle from PrettyFoto! üß© Try it:"})}),document.getElementById("backBtn").addEventListener("click",goHome),document.getElementById("browseGalleryLink").addEventListener("click",e=>{e.preventDefault(),goHomeAndShowGallery()}),document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",e=>{playSound("click"),document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),e.target.classList.add("active"),renderGallery(e.target.dataset.category)})}),document.querySelectorAll(".difficulty-btn").forEach(e=>{e.addEventListener("click",()=>{playSound("click"),gridSize=parseInt(e.dataset.size),startGame()})}),document.getElementById("hintBtn").addEventListener("click",showHint),document.getElementById("shuffleBtn").addEventListener("click",()=>{isDaily||(shuffleSeed=Date.now(),shuffleTiles(),moves=0,seconds=0,gameStarted=!1,updateGameStats())}),document.getElementById("playAgainBtn").addEventListener("click",()=>{completionModal.classList.add("hidden"),setModalAria(completionModal,!1),isDaily?goHome():startGame()}),document.getElementById("newPuzzleBtn").addEventListener("click",()=>{completionModal.classList.add("hidden"),setModalAria(completionModal,!1),goHome()});let e=1;document.getElementById("onboardingNext").addEventListener("click",()=>{playSound("click"),e<3?(e++,updateOnboardingSlide(e)):(onboardingModal.classList.add("hidden"),setModalAria(onboardingModal,!1),stats.hasSeenOnboarding=!0,saveStats())}),document.querySelectorAll(".onboarding-dots .dot").forEach(t=>{t.addEventListener("click",()=>{e=parseInt(t.dataset.slide),updateOnboardingSlide(e)})}),document.getElementById("closeEmail").addEventListener("click",()=>{emailModal.classList.add("hidden"),setModalAria(emailModal,!1)}),document.getElementById("skipEmail").addEventListener("click",()=>{emailModal.classList.add("hidden"),setModalAria(emailModal,!1),stats.hasSeenPromo=!0,saveStats()}),document.querySelectorAll('a[href*="prettyfoto.com"]').forEach(e=>{e.addEventListener("click",()=>{stats.shopClicks=(stats.shopClicks||0)+1,saveStats()})}),hintModal.addEventListener("click",()=>{hintModal.classList.add("hidden"),setModalAria(hintModal,!1)}),statsModal.addEventListener("click",e=>{e.target===statsModal&&(statsModal.classList.add("hidden"),setModalAria(statsModal,!1))}),completionModal.addEventListener("click",e=>{e.target===completionModal&&(completionModal.classList.add("hidden"),setModalAria(completionModal,!1))})}function updateOnboardingSlide(e){document.querySelectorAll(".onboarding-slide").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".onboarding-dots .dot").forEach(e=>e.classList.remove("active")),document.querySelector(`.onboarding-slide[data-slide="${e}"]`).classList.add("active"),document.querySelector(`.dot[data-slide="${e}"]`).classList.add("active"),document.getElementById("onboardingNext").textContent=3===e?"Let's Play!":"Next"}function toggleSound(){soundEnabled=!soundEnabled,updateSoundButton(),soundEnabled&&playSound("click")}function updateSoundButton(){const e=document.getElementById("soundBtn");e.textContent=soundEnabled?"üîä":"üîá",e.classList.toggle("muted",!soundEnabled)}function getDailyPuzzleNumber(){const e=new Date;return e.setHours(0,0,0,0),Math.floor((e.getTime()-EPOCH)/DAY_MS)+1}function getDailyPuzzle(){const e=(getDailyPuzzleNumber()-1)%puzzles.length;return puzzles[e]}function getCurrentWeekNumber(){const e=new Date;e.setHours(0,0,0,0);return(Math.floor((e.getTime()-EPOCH)/WEEK_MS)+1-1)%4+1}function isPuzzleFeaturedThisWeek(e){return!!e.featuredWeek&&e.featuredWeek===getCurrentWeekNumber()}function getTodayString(){return(new Date).toDateString()}function setupDailyPuzzle(){const e=getDailyPuzzle(),t=getDailyPuzzleNumber(),a=new Date;document.getElementById("puzzleNumber").textContent=t,document.getElementById("puzzleDate").textContent=a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});const o=document.getElementById("dailyImage");o.fetchPriority="high",setImageSrcWithFallback(o,getThumbnailUrl(e.image,400)),document.getElementById("dailyTitle").textContent=e.title,document.getElementById("dailyCategory").textContent=e.category;const r=getTodayString();stats.lastPlayedDate===r&&stats.todayCompleted?showDailyCompleted():hideDailyCompleted()}function showDailyCompleted(){document.getElementById("dailyOverlay").classList.remove("hidden"),document.getElementById("playDailyBtn").classList.add("hidden"),document.getElementById("dailyCompleted").classList.remove("hidden")}function hideDailyCompleted(){document.getElementById("dailyOverlay").classList.add("hidden"),document.getElementById("playDailyBtn").classList.remove("hidden"),document.getElementById("dailyCompleted").classList.add("hidden")}function playDaily(){playSound("click"),isDaily=!0,currentPuzzle=getDailyPuzzle(),gridSize=3,shuffleSeed=getDailyPuzzleNumber(),sessionState.dailyStarted||(sessionState.dailyStarted=!0,sessionState.firstAction||(sessionState.firstAction="daily")),puzzleTitle.textContent=currentPuzzle.title,setImageSrcWithFallback(puzzlePreview,getThumbnailUrl(currentPuzzle.image,400)),shopLink.href=currentPuzzle.shopUrl,document.getElementById("galleryLink").href=currentPuzzle.galleryUrl,document.getElementById("completionShopLink").href=currentPuzzle.shopUrl,document.getElementById("completionGalleryLink").href=currentPuzzle.galleryUrl,setImageSrcWithFallback(document.getElementById("hintImage"),getThumbnailUrl(currentPuzzle.image,400)),document.getElementById("dailyBadge").classList.remove("hidden"),document.getElementById("dailyBadgeNum").textContent=getDailyPuzzleNumber(),document.getElementById("shuffleBtn").classList.add("hidden"),document.getElementById("browseGalleryLink").classList.remove("hidden"),homeView.classList.add("hidden"),puzzleView.classList.remove("hidden"),setViewAria(homeView,!0),setViewAria(puzzleView,!1),difficultySelect.classList.add("hidden"),gameArea.classList.remove("hidden"),resetGame(),createTiles()}function startCountdown(){function e(){const e=new Date,t=new Date(e);t.setDate(t.getDate()+1),t.setHours(0,0,0,0);const a=t-e,o=Math.floor(a/36e5),r=Math.floor(a%36e5/6e4),s=Math.floor(a%6e4/1e3);document.getElementById("countdown").textContent=`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}e(),setInterval(e,1e3)}function getThumbnailUrl(e,t=280){if(!e||"string"!=typeof e)return e;let a=e.replace(/w_\d+,h_\d+/,`w_${t},h_${t}`).replace(/q_auto:best/,"q_auto:good");return a.includes("/image/upload/")&&!a.includes("f_auto")&&(a=a.replace("/image/upload/","/image/upload/f_auto,")),a}function renderGallery(e="all"){let t="all"===e?puzzles:puzzles.filter(t=>t.category===e);t=t.sort((e,t)=>{const a=isPuzzleFeaturedThisWeek(e),o=isPuzzleFeaturedThisWeek(t);return a&&!o?-1:!a&&o?1:0}),puzzleGallery.innerHTML=t.map(e=>{const t=isPuzzleFeaturedThisWeek(e);return`\n        <div class="puzzle-card ${t?"featured":""}">\n            ${t?'<span class="featured-badge">‚ú® New This Week</span>':""}\n            <img src="${getThumbnailUrl(e.image)}" alt="${e.title}" class="puzzle-card-image" loading="lazy" decoding="async" width="280" height="280" onclick="selectPuzzle(${e.id})">\n            <div class="puzzle-card-info">\n                <div class="puzzle-card-title">${e.title}</div>\n                <div class="puzzle-card-actions">\n                    <button class="card-story-btn" onclick="event.stopPropagation(); showStoryModal(puzzles.find(p=>p.id===${e.id}))">üìñ</button>\n                    <button class="card-play-btn" onclick="selectPuzzle(${e.id})">‚ñ∂Ô∏è Play</button>\n                </div>\n            </div>\n        </div>\n    `}).join("")}function selectPuzzle(e){playSound("click"),isDaily=!1,currentPuzzle=puzzles.find(t=>t.id===e),currentPuzzle&&(sessionState.galleryStarted||(sessionState.galleryStarted=!0,sessionState.firstAction||(sessionState.firstAction="gallery")),shuffleSeed=Date.now(),puzzleTitle.textContent=currentPuzzle.title,setImageSrcWithFallback(puzzlePreview,getThumbnailUrl(currentPuzzle.image,400)),shopLink.href=currentPuzzle.shopUrl,document.getElementById("galleryLink").href=currentPuzzle.galleryUrl,document.getElementById("completionShopLink").href=currentPuzzle.shopUrl,document.getElementById("completionGalleryLink").href=currentPuzzle.galleryUrl,setImageSrcWithFallback(document.getElementById("hintImage"),getThumbnailUrl(currentPuzzle.image,400)),document.getElementById("dailyBadge").classList.add("hidden"),document.getElementById("shuffleBtn").classList.remove("hidden"),document.getElementById("browseGalleryLink").classList.add("hidden"),homeView.classList.add("hidden"),puzzleView.classList.remove("hidden"),setViewAria(homeView,!0),setViewAria(puzzleView,!1),difficultySelect.classList.remove("hidden"),gameArea.classList.add("hidden"),resetGame())}function goHome(){playSound("click"),puzzleView.classList.add("hidden"),homeView.classList.remove("hidden"),setViewAria(puzzleView,!0),setViewAria(homeView,!1),resetGame(),setupDailyPuzzle()}function goHomeAndShowGallery(){goHome(),requestAnimationFrame(()=>{const e=document.querySelector(".free-play-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})})}function getShareUrl(){if("undefined"!=typeof window&&window.location&&"file://"!==window.location.origin)try{const e=new URL(window.location.href);if(e.origin.includes("prettyfoto.com"))return e.origin+(e.pathname||"/puzzles")}catch(e){}return"https://prettyfoto.com/puzzles"}function shareApp(e={}){const t=getShareUrl(),a=e.title||"PrettyFoto Daily Puzzles",o=e.text||"Daily nature photo puzzles ‚Äî new puzzle every day! üß©üå∏",r={title:a,text:o,url:t};"undefined"!=typeof navigator&&navigator.share?navigator.share(r).catch(()=>copyShareFallback(t,o)):copyShareFallback(t,o)}function copyShareFallback(e,t){const a=t?`${t}\n${e}`:e;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(a).then(()=>showShareToast("Link copied! Paste it in Instagram, Facebook, or any app."));else{const t=document.createElement("textarea");t.value=a,t.setAttribute("readonly",""),t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),showShareToast("Link copied! Paste it in Instagram, Facebook, or any app.")}catch(t){showShareToast("Share: "+e)}document.body.removeChild(t)}}function showShareToast(e){const t=document.getElementById("shareToast");t&&t.remove();const a=document.createElement("div");a.id="shareToast",a.className="share-toast",a.textContent=e,document.body.appendChild(a),requestAnimationFrame(()=>a.classList.add("show")),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>a.remove(),300)},3e3)}function startGame(){difficultySelect.classList.add("hidden"),gameArea.classList.remove("hidden"),resetGame(),createTiles()}function resetGame(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),seconds=0,moves=0,gameStarted=!1,tiles=[],tileImages=[],updateGameStats(),puzzleBoard.innerHTML=""}function createTiles(){const e=gridSize*gridSize,t=Math.min(340,window.innerWidth-44),a=Math.floor((t-3*(gridSize-1)-12)/gridSize);puzzleBoard.style.gridTemplateColumns=`repeat(${gridSize}, ${a}px)`,puzzleBoard.style.gridTemplateRows=`repeat(${gridSize}, ${a}px)`,tiles=Array.from({length:e},(e,t)=>t),emptyIndex=e-1;const o=new Image;loadImageWithCacheFallback(getThumbnailUrl(currentPuzzle.image,400),o,()=>{for(let t=0;t<e;t++){const e=document.createElement("canvas");e.width=2*a,e.height=2*a;const r=e.getContext("2d"),s=Math.floor(t/gridSize),i=t%gridSize,n=o.width/gridSize;r.drawImage(o,i*n,s*n,n,n,0,0,e.width,e.height),tileImages[t]=e.toDataURL("image/jpeg",.9)}shuffleTiles(),renderBoard(a)},()=>{0===puzzleBoard.children.length&&(puzzleBoard.innerHTML='<p class="offline-hint">Image unavailable. Try again when online, or play another puzzle.</p>')})}function seededRandom(e){const t=1e4*Math.sin(e++);return t-Math.floor(t)}function countInversions(){const e=gridSize*gridSize,t=e-1,a=[];for(let o=0;o<e;o++)tiles[o]!==t&&a.push(tiles[o]);let o=0;for(let e=0;e<a.length;e++)for(let t=e+1;t<a.length;t++)a[e]>a[t]&&o++;return o}function isSolvable(){const e=countInversions(),t=Math.floor(emptyIndex/gridSize);return(e+(gridSize-1-t))%2==0}function ensureSolvable(){if(isSolvable())return;const e=gridSize*gridSize,t=e-1;let a=-1,o=-1;for(let r=0;r<e&&-1===o;r++)tiles[r]!==t&&(-1!==a?o=r:a=r);if(-1!==a&&-1!==o){const e=tiles[a];tiles[a]=tiles[o],tiles[o]=e}}function shuffleTiles(){const e=gridSize*gridSize;tiles=Array.from({length:e},(e,t)=>t),emptyIndex=e-1;let t=shuffleSeed;const a=gridSize*gridSize*25;for(let o=0;o<a;o++){const a=getMovableNeighbors(emptyIndex),r=a[Math.floor(seededRandom(t+o)*a.length)];tiles[emptyIndex]=tiles[r],tiles[r]=e-1,emptyIndex=r}ensureSolvable(),cachedTileSize>0&&renderBoard(cachedTileSize)}function getMovableNeighbors(e){const t=[],a=Math.floor(e/gridSize),o=e%gridSize;return a>0&&t.push(e-gridSize),a<gridSize-1&&t.push(e+gridSize),o>0&&t.push(e-1),o<gridSize-1&&t.push(e+1),t}function renderBoard(e){cachedTileSize=e;const t=gridSize*gridSize;puzzleBoard.innerHTML="";for(let a=0;a<t;a++){const o=tiles[a],r=document.createElement("div");if(r.className="tile",r.dataset.position=a,r.style.width=`${e}px`,r.style.height=`${e}px`,o===t-1)r.classList.add("empty");else{const e=document.createElement("img");e.src=tileImages[o],r.appendChild(e),isAdjacentToEmpty(a)&&r.classList.add("movable"),r.addEventListener("click",()=>handleTileClick(a))}puzzleBoard.appendChild(r)}}function isAdjacentToEmpty(e){return getMovableNeighbors(emptyIndex).includes(e)}function handleTileClick(e){if(!isAdjacentToEmpty(e))return;playSound("slide"),vibrate(10),gameStarted||(gameStarted=!0,startTimer());const t=puzzleBoard.children[e],a=t.offsetWidth,o=a+3,r=Math.floor(e/gridSize),s=e%gridSize,i=Math.floor(emptyIndex/gridSize),n=emptyIndex%gridSize;t.classList.add("sliding"),t.style.transform=`translate(${(n-s)*o}px, ${(i-r)*o}px)`,setTimeout(()=>{tiles[emptyIndex]=tiles[e],tiles[e]=gridSize*gridSize-1,emptyIndex=e,moves++,updateGameStats(),renderBoard(a),checkWin()&&setTimeout(puzzleComplete,300)},120)}function checkWin(){const e=gridSize*gridSize;for(let t=0;t<e;t++)if(tiles[t]!==t)return!1;return!0}function startTimer(){seconds=0,timerInterval=setInterval(()=>{seconds++,updateGameStats()},1e3)}function formatTime(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}function updateGameStats(){timerDisplay.textContent=formatTime(seconds),movesDisplay.textContent=moves}function puzzleComplete(){timerInterval&&(clearInterval(timerInterval),timerInterval=null),playSound("win"),vibrate([100,50,100,50,200]),showConfetti(),trackGamePlay("slider"),currentPuzzle.category&&trackCategoryPlay(currentPuzzle.category),markPuzzleCompleted(currentPuzzle.id),setImageSrcWithFallback(document.getElementById("completedImage"),getThumbnailUrl(currentPuzzle.image,400)),document.getElementById("finalTime").textContent=formatTime(seconds),document.getElementById("finalMoves").textContent=moves,document.getElementById("completionShopLink").href=currentPuzzle.shopUrl,sessionState.sessionRecorded||(sessionState.sessionRecorded=!0,"daily"===sessionState.firstAction?stats.dailyFirstCount++:"gallery"===sessionState.firstAction&&stats.galleryFirstCount++);if(isDaily){document.getElementById("shareSection").classList.remove("hidden"),document.getElementById("playAgainBtn").textContent="Back Home";const e=getTodayString();if(stats.lastPlayedDate!==e){const e=new Date;e.setDate(e.getDate()-1),stats.currentStreak=stats.lastPlayedDate===e.toDateString()?stats.currentStreak+1:1}stats.played++,stats.won++,stats.bestStreak=Math.max(stats.bestStreak,stats.currentStreak),stats.totalMoves+=moves,stats.totalTime+=seconds,stats.lastPlayedDate=e,stats.todayCompleted=!0,stats.todayMoves=moves,stats.todayTime=seconds,stats.dailyPlays++,saveStats(),stats.hasSeenPromo||1!==stats.played||setTimeout(()=>{emailModal.classList.remove("hidden"),setModalAria(emailModal,!0)},2e3)}else document.getElementById("shareSection").classList.remove("hidden"),document.getElementById("playAgainBtn").textContent="Play Again",stats.galleryPlays++,saveStats();renderCompletedBoard(),setTimeout(()=>completionModal.classList.remove("hidden"),500)}function renderCompletedBoard(){const e=gridSize*gridSize,t=cachedTileSize||80;puzzleBoard.innerHTML="";for(let a=0;a<e;a++){const e=document.createElement("div");e.className="tile",e.style.width=`${t}px`,e.style.height=`${t}px`;const o=document.createElement("img");o.src=tileImages[a],e.appendChild(o),puzzleBoard.appendChild(e)}}function showConfetti(){const e=confettiCanvas.getContext("2d");confettiCanvas.width=window.innerWidth,confettiCanvas.height=window.innerHeight;const t=[],a=["#e17055","#00b894","#fdcb6e","#6c5ce7","#fd79a8"];for(let e=0;e<100;e++)t.push({x:Math.random()*confettiCanvas.width,y:-20-100*Math.random(),vx:4*(Math.random()-.5),vy:3*Math.random()+2,color:a[Math.floor(Math.random()*a.length)],size:8*Math.random()+4,rotation:360*Math.random(),rotationSpeed:10*(Math.random()-.5)});let o=0;!function a(){e.clearRect(0,0,confettiCanvas.width,confettiCanvas.height),t.forEach(t=>{e.save(),e.translate(t.x,t.y),e.rotate(t.rotation*Math.PI/180),e.fillStyle=t.color,e.fillRect(-t.size/2,-t.size/2,t.size,t.size),e.restore(),t.x+=t.vx,t.y+=t.vy,t.vy+=.1,t.rotation+=t.rotationSpeed}),++o<150?requestAnimationFrame(a):e.clearRect(0,0,confettiCanvas.width,confettiCanvas.height)}()}function loadStats(){const e=localStorage.getItem(STORAGE_KEY);if(e){const t=JSON.parse(e);stats={...stats,...t},stats.dailyFirstCount=stats.dailyFirstCount||0,stats.galleryFirstCount=stats.galleryFirstCount||0,stats.dailySkippedCount=stats.dailySkippedCount||0,stats.galleryPlays=stats.galleryPlays||0,stats.dailyPlays=stats.dailyPlays||0,stats.shopClicks=stats.shopClicks||0}const t=localStorage.getItem("prettyfoto_sound");null!==t&&(soundEnabled="true"===t)}function saveStats(){localStorage.setItem(STORAGE_KEY,JSON.stringify(stats)),localStorage.setItem("prettyfoto_sound",soundEnabled.toString())}function showStats(){playSound("click"),document.getElementById("statPlayed").textContent=stats.played,document.getElementById("statWon").textContent=stats.won,document.getElementById("statStreak").textContent=stats.currentStreak,document.getElementById("statBest").textContent=stats.bestStreak,stats.won>0&&(document.getElementById("statAvgMoves").textContent=Math.round(stats.totalMoves/stats.won),document.getElementById("statAvgTime").textContent=formatTime(Math.round(stats.totalTime/stats.won)));const e=getTodayString();stats.lastPlayedDate===e&&stats.todayCompleted?(document.getElementById("todayResult").classList.remove("hidden"),document.getElementById("todayResultText").textContent=`Solved in ${stats.todayMoves} moves, ${formatTime(stats.todayTime)}`):document.getElementById("todayResult").classList.add("hidden"),document.getElementById("statDailyFirst").textContent=stats.dailyFirstCount||0,document.getElementById("statGalleryFirst").textContent=stats.galleryFirstCount||0,document.getElementById("statDailyPlays").textContent=stats.dailyPlays||0,document.getElementById("statGalleryPlays").textContent=stats.galleryPlays||0;const t=(stats.dailyFirstCount||0)+(stats.galleryFirstCount||0),a=t>0?Math.round((stats.dailyFirstCount||0)/t*100):0,o=t>0?Math.round((stats.galleryFirstCount||0)/t*100):0;let r="";r=0===t?"üéÆ Complete puzzles to see your play patterns!":a>o?`üìÖ ${a}% of sessions start with Daily - habit forming!`:o>a?`üñºÔ∏è ${o}% of sessions start with Gallery - browsing works!`:"‚öñÔ∏è Equal mix of Daily & Gallery starts - variety is key!",document.getElementById("analyticsInsight").textContent=r,statsModal.classList.remove("hidden"),setModalAria(statsModal,!0)}function showHint(){playSound("click"),hintModal.classList.remove("hidden"),setModalAria(hintModal,!0)}window.addEventListener("resize",()=>{if(currentPuzzle&&!gameArea.classList.contains("hidden")&&tileImages.length>0){const e=Math.min(340,window.innerWidth-44),t=Math.floor((e-3*(gridSize-1)-12)/gridSize);puzzleBoard.style.gridTemplateColumns=`repeat(${gridSize}, ${t}px)`,puzzleBoard.style.gridTemplateRows=`repeat(${gridSize}, ${t}px)`,renderBoard(t)}});let currentGameMode="slider";function setupGameModeTabs(){document.querySelectorAll(".mode-tab").forEach(e=>{e.addEventListener("click",()=>{playSound("click");switchGameMode(e.dataset.mode)})})}function switchGameMode(e){currentGameMode=e,document.querySelectorAll(".mode-tab").forEach(e=>e.classList.remove("active")),document.querySelector(`.mode-tab[data-mode="${e}"]`).classList.add("active"),document.querySelectorAll(".game-home").forEach(e=>e.classList.add("hidden"));const t=`${e}Home`,a=document.getElementById(t);a&&(a.classList.remove("hidden"),"slider"===e&&setupDailyPuzzle())}